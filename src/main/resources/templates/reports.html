<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á—ë—Ç—ã —Å–∏—Å—Ç–µ–º—ã</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/reports.css}">
    <meta name="_csrf" th:content="${_csrf.token}"/>
</head>
<body>
<div th:replace="~{fragments/adminHeader :: header}"></div>

<main class="main-container">
    <div class="page-header">
        <h1 class="page-title">–û—Ç—á—ë—Ç—ã —Å–∏—Å—Ç–µ–º—ã</h1>
        <span class="admin-badge">ADMIN</span>
    </div>

    <!-- –ë–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ -->
    <div class="report-creation-section">
        <div class="creation-card">
            <h2 class="section-title">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞</h2>

            <div class="date-inputs">
                <div class="date-input-group">
                    <label for="startDate" class="date-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞</label>
                    <div class="date-input-wrapper">
                        <input type="date" id="startDate" class="date-input"
                               th:value="${periodStart}">
                        <button type="button" class="date-btn" onclick="openCalendar('start')">üìÖ</button>
                    </div>
                </div>

                <div class="date-separator">‚Üí</div>

                <div class="date-input-group">
                    <label for="endDate" class="date-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞</label>
                    <div class="date-input-wrapper">
                        <input type="date" id="endDate" class="date-input"
                               th:value="${periodEnd}">
                        <button type="button" class="date-btn" onclick="openCalendar('end')">üìÖ</button>
                    </div>
                </div>
            </div>

            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
            <div id="calendarModal" class="calendar-modal">
                <div class="calendar-header">
                    <h3 id="calendarTitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h3>
                    <button type="button" class="btn-close" onclick="closeCalendar()">&times;</button>
                </div>
                <div class="calendar-body">
                    <div class="calendar-controls">
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">
                            ‚Üê
                        </button>
                        <span id="calendarMonth" class="calendar-month"></span>
                        <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">
                            ‚Üí
                        </button>
                    </div>
                    <div id="calendarContainer" class="calendar-grid"></div>
                </div>
            </div>

            <div class="creation-info">
                <div class="info-item">
                    <span class="info-icon">‚ÑπÔ∏è</span>
                    <span class="info-text">
                        –û—Ç—á—ë—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ
                    </span>
                </div>
                <div class="info-item" id="existingReportWarning" style="display: none;">
                    <span class="info-icon">‚ö†Ô∏è</span>
                    <span class="info-text">
                        –û—Ç—á—ë—Ç –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω
                    </span>
                </div>
            </div>

            <div class="creation-actions">
                <button type="button" class="btn btn-secondary" onclick="checkExistingReport()">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ—Ç—á—ë—Ç–∞
                </button>
                <button type="button" class="btn btn-primary" onclick="createReport()" id="createReportBtn">
                    <span class="btn-icon">üìä</span>
                    –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç
                </button>
            </div>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="quick-actions-section">
        <h2 class="section-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
        <div class="actions-grid">
            <button type="button" class="action-card" onclick="showLatestReport()"><!-- –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –º–µ—Ç–æ–¥ -->
                <div class="action-icon">üìã</div>
                <div class="action-title">–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á—ë—Ç</div>
                <div class="action-description">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç</div>
            </button>

            <button type="button" class="action-card" onclick="showAllReports()">
                <div class="action-icon">üìö</div>
                <div class="action-title">–í—Å–µ –æ—Ç—á—ë—Ç—ã</div>
                <div class="action-description">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –æ—Ç—á—ë—Ç—ã</div>
            </button>

            <button type="button" class="action-card" onclick="showWeekReport()">
                <div class="action-icon">üìà</div>
                <div class="action-title">–û—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                <div class="action-description">–°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</div>
            </button>

            <button type="button" class="action-card" onclick="showMonthReport()">
                <div class="action-icon">üìÖ</div>
                <div class="action-title">–û—Ç—á—ë—Ç –∑–∞ –º–µ—Å—è—Ü</div>
                <div class="action-description">–°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div>
            </button>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤ -->
    <div class="reports-list-section">
        <div class="section-header">
            <h2 class="section-title">–°–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤</h2>
            <div class="section-header-actions">
                <select id="pageSizeSelect" class="page-size-select" onchange="changePageSize(this.value)">
                    <option value="8">8</option>
                    <option value="16">16</option>
                    <option value="32">32</option>
                    <option value="48">48</option>
                </select>
                <button type="button" class="btn btn-secondary btn-small" onclick="refreshReports()" id="refreshBtn">
                    <span id="refreshIcon">üîÑ</span>
                    –û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>

        <div id="loadingContainer" class="loading-container">
            <div class="loading-spinner"></div>
            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á—ë—Ç–æ–≤...</div>
        </div>

        <div id="tableContainer" class="table-container" style="display: none;">
            <table class="reports-table">
                <thead>
                <tr>
                    <th data-sort="period" class="sortable">
                        <span class="th-content">–ü–µ—Ä–∏–æ–¥</span>
                    </th>
                    <th>
                        <span class="th-content">–°—Ç–∞—Ç—É—Å</span>
                    </th>
                    <th data-sort="created" class="sortable sort-desc">
                        <span class="th-content">–°–æ–∑–¥–∞–Ω</span>
                    </th>
                    <th>
                        <span class="th-content">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
                    </th>
                    <th class="actions-header">
                        <span class="th-content">–î–µ–π—Å—Ç–≤–∏—è</span>
                    </th>
                </tr>
                </thead>
                <tbody id="reportsTableBody">

                </tbody>
            </table>
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="empty-state-icon">üìä</div>
            <h3 class="empty-state-title">–û—Ç—á—ë—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p class="empty-state-description">–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤.</p>
            <button type="button" class="btn btn-primary" onclick="createReport()">
                –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –æ—Ç—á—ë—Ç
            </button>
        </div>

        <div class="reports-stats" id="reportsStats">
            <div class="stats-item">
                <span class="stats-label">–í—Å–µ–≥–æ –æ—Ç—á—ë—Ç–æ–≤:</span>
                <span class="stats-value" id="totalCount">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ:</span>
                <span class="stats-value" id="completedCount">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">–§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è:</span>
                <span class="stats-value" id="processingCount">0</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">–°—Ç—Ä–∞–Ω–∏—Ü–∞:</span>
                <span class="stats-value" id="pageInfo">1/1</span>
            </div>
            <div class="stats-item">
                <span class="stats-label">–û—Ç—á—ë—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</span>
                <span class="stats-value" id="pageSizeInfo">8</span>
            </div>
        </div>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination-section" id="paginationSection" style="display: none;">
        <div class="pagination-controls">

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º -->
            <div class="pagination-nav">
                <button class="pagination-btn" id="prevPageBtn" onclick="goToPreviousPage()"
                        title="–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" disabled>
                    ‚Üê
                </button>

                <div class="pagination-pages" id="paginationPages">
                </div>

                <button class="pagination-btn" id="nextPageBtn" onclick="goToNextPage()"
                        title="–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" disabled>
                    ‚Üí
                </button>
            </div>

            <div class="pagination-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span id="currentPageSpan">1</span> –∏–∑
                <span id="totalPagesSpan">1</span>
                (–≤—Å–µ–≥–æ –æ—Ç—á—ë—Ç–æ–≤: <span id="totalElementsSpan">0</span>)
            </div>
        </div>
    </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á—ë—Ç–∞ -->
<div id="reportViewModal" class="modal-overlay">
    <div class="modal-content modal-wide">
        <div class="modal-header">
            <h3 class="modal-title">–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞</h3>
            <div class="modal-header-actions">
                <button type="button" class="btn btn-secondary btn-small" onclick="refreshReportContent()" title="–û–±–Ω–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç">
                    <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                </button>
                <button type="button" class="btn-close" onclick="closeReportModal()">&times;</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="report-header" id="reportHeader">
                <div class="report-period">
                    <span class="period-label">–ü–µ—Ä–∏–æ–¥:</span>
                    <span class="period-value" id="reportPeriod">-</span>
                </div>
                <div class="report-status">
                    <span class="status-label">–°—Ç–∞—Ç—É—Å:</span>
                    <div class="status-badge" id="reportStatusBadge">-</div>
                </div>
                <div class="report-time">
                    <span class="time-label">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                    <span class="time-value" id="reportExecutionTime">-</span>
                </div>
            </div>

            <div class="report-content-container">
                <div class="loading-overlay" id="reportLoading">
                    <div class="loading-spinner"></div>
                    <div>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á—ë—Ç–∞...</div>
                </div>
                <div id="reportContent" class="report-content"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeReportModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button type="button" class="btn btn-primary" onclick="downloadCurrentReport()" id="downloadReportBtn">
                –°–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç
            </button>
        </div>
    </div>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="notificationsContainer"></div>

<script th:src="@{/js/reports.js}"></script>
</body>
</html>