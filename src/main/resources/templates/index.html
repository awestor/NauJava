<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calorie Tracker</title>
  <link rel="stylesheet" th:href="@{/css/header.css}">
  <link rel="stylesheet" th:href="@{/css/index.css}">
</head>
<body>
<div th:replace="${#authorization.expression('hasRole(''USER'')')} ?
                ~{fragments/header :: header} :
                ~{fragments/adminHeader :: header}"></div>
<main class="main-container">
  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div sec:authorize="isAuthenticated()">
      <div class="page-header">
        <h1 class="page-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Calorie Tracker</h1>
      </div>

      <div class="dashboard-grid">
        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div class="menu-card" sec:authorize="hasRole('USER')">
          <a th:href="@{/view/products/list}" class="card-link">
            <div class="card-icon">ü•ó</div>
            <h3 class="card-title">–ú–æ–∏ –ø—Ä–æ–¥—É–∫—Ç—ã</h3>
            <p class="card-description">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ –ø–∏—Ç–∞–Ω–∏—è</p>
          </a>
        </div>

        <div class="menu-card" sec:authorize="hasRole('USER')">
          <a th:href="@{/view/meals/list}" class="card-link">
            <div class="card-icon">üçΩÔ∏è</div>
            <h3 class="card-title">–ü—Ä–∏—ë–º—ã –ø–∏—â–∏</h3>
            <p class="card-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—ë–º–∞–º–∏ –ø–∏—â–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è</p>
          </a>
        </div>

        <div class="menu-card" sec:authorize="hasRole('USER')">
          <a th:href="@{/view/daily-reports/stat}" class="card-link">
            <div class="card-icon">üìà</div>
            <h3 class="card-title">–ê–Ω–∞–ª–∏–∑ –ø–∏—Ç–∞–Ω–∏—è</h3>
            <p class="card-description">–ì—Ä–∞—Ñ–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤</p>
          </a>
        </div>

        <!-- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ -->
        <div class="menu-card admin-card" sec:authorize="hasRole('ADMIN')">
          <a th:href="@{/swagger-ui.html}" class="card-link" target="_blank">
            <div class="card-icon">üìö</div>
            <h3 class="card-title">API Documentation</h3>
            <p class="card-description">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –≤ Swagger UI</p>
            <span class="admin-badge">ADMIN</span>
          </a>
        </div>

        <div class="menu-card admin-card" sec:authorize="hasRole('ADMIN')">
          <a th:href="@{/admin/users}" class="card-link">
            <div class="card-icon">üë•</div>
            <h3 class="card-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
            <p class="card-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
            <span class="admin-badge">ADMIN</span>
          </a>
        </div>

        <div class="menu-card admin-card" sec:authorize="hasRole('ADMIN')">
          <a th:href="@{/admin/view/reports/}" class="card-link">
            <div class="card-icon">üìä</div>
            <h3 class="card-title">–û—Ç—á—ë—Ç—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
            <p class="card-description">–ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã</p>
            <span class="admin-badge">ADMIN</span>
          </a>
        </div>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–º –¥–∞–Ω–Ω—ã–º -->
      <div class="quick-stats" sec:authorize="!hasRole('ADMIN')">
        <h2 class="section-title">–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="todayCalories">--</div>
            <div class="stat-label">–∫–∫–∞–ª –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–æ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="todayMeals">--</div>
            <div class="stat-label">–ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="todayGoal">--</div>
            <div class="stat-label">% –æ—Ç —Ü–µ–ª–∏</div>
          </div>
        </div>
      </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div sec:authorize="!isAuthenticated()">
      <div class="hero-section">
        <div class="hero-content">
          <h1 class="hero-title">Calorie<span class="logo-accent">Tracker</span></h1>
          <p class="hero-subtitle">
            –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è –ø—Ä–æ—â–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è
          </p>
          <p class="hero-description">
            –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤, –¥–æ—Å—Ç–∏–≥–∞–π—Ç–µ —Å–≤–æ–∏—Ö —Ü–µ–ª–µ–π
            –∏ –≤–µ–¥–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–≥–æ —É–¥–æ–±–Ω–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞ –∫–∞–ª–æ—Ä–∏–π.
          </p>

          <div class="hero-features">
            <div class="feature">
              <span class="feature-icon">üìä</span>
              <span class="feature-text">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üì±</span>
              <span class="feature-text">–£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</span>
            </div>
            <div class="feature">
              <span class="feature-icon">üéØ</span>
              <span class="feature-text">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π</span>
            </div>
          </div>

          <div class="auth-buttons">
            <a th:href="@{/login}" class="btn btn-primary btn-large">
              –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
            </a>
            <a th:href="@{/register}" class="btn btn-secondary btn-large">
              –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </a>
          </div>
        </div>

        <div class="hero-visual">
          <div class="visual-card">
            <div class="chart-placeholder"></div>
            <div class="stats-preview">
              <div class="preview-stat">
                <span class="preview-label">–ö–∞–ª–æ—Ä–∏–∏</span>
                <span class="preview-value">1850/2000</span>
              </div>
              <div class="preview-stat">
                <span class="preview-label">–ë–µ–ª–∫–∏</span>
                <span class="preview-value">120/150–≥</span>
              </div>
              <div class="preview-stat">
                <span class="preview-label">–°–µ—Ä–∏—è</span>
                <span class="preview-value highlight">7 –¥–Ω–µ–π</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª -->
      <div class="info-section">
        <h2 class="section-title">–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç CalorieTracker?</h2>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-card-icon">üçé</div>
            <h3>–ü—Ä–æ—Å—Ç–æ–π —É—á—ë—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h3>
            <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã –±—ã—Å—Ç—Ä–æ –∏ –ª–µ–≥–∫–æ —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π –æ–±—à–∏—Ä–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
          </div>
          <div class="feature-card">
            <div class="feature-card-icon">üìà</div>
            <h3>–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
            <p>–ù–∞–≥–ª—è–¥–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç—ã –ø–æ–º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å –≤–∞—à–∏ –ø–∏—â–µ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏</p>
          </div>
          <div class="feature-card">
            <div class="feature-card-icon">üéØ</div>
            <h3>–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π</h3>
            <p>–°—Ç–∞–≤—å—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ü–µ–ª–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –∏—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏</p>
          </div>
          <div class="feature-card">
            <div class="feature-card-icon">üì±</div>
            <h3>–£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
            <p>–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    document.addEventListener('DOMContentLoaded', function() {
        const authSection = document.querySelector('[sec\\:authorize="isAuthenticated()"]');
        if (authSection && !authSection.hasAttribute('hidden')) {
            loadTodayStats();
        }
    });

    async function loadTodayStats() {
        try {
            const response = await fetch('/api/daily-reports/today/stats');
            if (response.ok) {
                const stats = await response.json();
                updateStatsDisplay(stats);
            }
        } catch (error) {
            console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ —Å–µ–≥–æ–¥–Ω—è');
        }
    }

    function updateStatsDisplay(stats) {
        const caloriesElem = document.getElementById('todayCalories');
        const mealsElem = document.getElementById('todayMeals');
        const goalElem = document.getElementById('todayGoal');

        if (caloriesElem) caloriesElem.textContent = stats.calories || '0';
        if (mealsElem) mealsElem.textContent = stats.meals || '0';
        if (goalElem) goalElem.textContent = stats.goalPercentage || '0%';
    }
  </script>
</body>
</html>