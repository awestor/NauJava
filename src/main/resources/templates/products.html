<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/products.css}">
    <meta name="_csrf" th:content="${_csrf.token}"/>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<main class="main-container">
    <div class="page-header">
        <h1 class="page-title">–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h1>
        <a th:href="@{/view/products/createForm}" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"/>
            </svg>
            –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç
        </a>
    </div>

    <!-- –ü–æ–∏—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="controls-section">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
            <div class="search-icon">üîç</div>
        </div>

        <div class="pagination-info" id="paginationInfo">
            –ü–æ–∫–∞–∑–∞–Ω–æ <span id="shownCount">0</span> –∏–∑ <span id="totalCount" th:text="${#lists.size(products)}">0</span> –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        </div>
    </div>

    <div class="table-container">
        <table class="products-table">
            <thead>
            <tr>
                <th data-sort="order" class="sortable sort-desc">
                    <span class="th-content">‚Ññ</span>
                </th>
                <th data-sort="name" class="sortable">
                    <span class="th-content">–ù–∞–∑–≤–∞–Ω–∏–µ</span>
                </th>
                <th data-sort="calories" class="sortable">
                    <span class="th-content">–ö–∞–ª–æ—Ä–∏–∏</span>
                </th>
                <th data-sort="proteins" class="sortable">
                    <span class="th-content">–ë–µ–ª–∫–∏</span>
                </th>
                <th data-sort="fats" class="sortable">
                    <span class="th-content">–ñ–∏—Ä—ã</span>
                </th>
                <th data-sort="carbs" class="sortable">
                    <span class="th-content">–£–≥–ª–µ–≤–æ–¥—ã</span>
                </th>
                <th class="actions-header">
                    <span class="th-content">–î–µ–π—Å—Ç–≤–∏—è</span>
                </th>
            </tr>
            </thead>
            <tbody id="productsTableBody">
            <tr th:each="product, stat : ${products}" th:data-product-id="${product.id}" class="product-row">
                <td th:text="${stat.count}" class="font-mono sort-asc order-cell"></td>
                <td th:text="${product.name}" class="product-name"></td>
                <td th:text="${#numbers.formatDecimal(product.caloriesPer100g, 1, 2)} + ' –∫–∫–∞–ª'" class="font-mono"></td>
                <td th:text="${#numbers.formatDecimal(product.proteinsPer100g, 1, 2)} + ' –≥'" class="font-mono"></td>
                <td th:text="${#numbers.formatDecimal(product.fatsPer100g, 1, 2)} + ' –≥'" class="font-mono"></td>
                <td th:text="${#numbers.formatDecimal(product.carbsPer100g, 1, 2)} + ' –≥'" class="font-mono"></td>
                <td class="actions-cell">
                    <div class="action-buttons">
                        <button class="btn-icon" th:onclick="'editProduct(' + ${product.id} + ')'" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSA0SDRhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0YTIgMiAwIDAgMCAyLTJ2LTciPjwvcGF0aD48cGF0aCBkPSJNMTguNSAyLjVhMi4xMjEgMi4xMjEgMCAwIDEgMyAzTDEyIDE1bC00IDEgMS00IDkuNS05LjV6Ij48L3BhdGg+PC9zdmc+" alt="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" width="16" height="16">
                        </button>
                        <button class="btn-icon" th:onclick="'deleteProduct(' + ${product.id} + ')'" title="–£–¥–∞–ª–∏—Ç—å">
                            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwb2x5bGluZSBwb2ludHM9IjMgNiA1IDYgMjEgNiI+PC9wb2x5bGluZT48cGF0aCBkPSJNMTkgNnYxNGEyIDIgMCAwIDEtMiAySDdhMiAyIDAgMCAxLTItMlY2bTMgMFY0YTIgMiAwIDAgMSAyLTJoNGEyIDIgMCAwIDEgMiAydjIiPjwvcGF0aD48L3N2Zz4=" alt="–£–¥–∞–ª–∏—Ç—å" width="16" height="16">
                        </button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination-container" id="paginationContainer" style="display: none;">
        <div class="pagination">
            <button class="pagination-btn" id="prevPage" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>

            <div class="pagination-pages" id="paginationPages">
                <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <button class="pagination-btn" id="nextPage">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>

        <div class="page-size-selector">
            <label for="pageSizeSelect">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ:</label>
            <select id="pageSizeSelect" class="page-size-select">
                <option value="8">8</option>
                <option value="16">16</option>
                <option value="24">24</option>
                <option value="48">48</option>
            </select>
        </div>
    </div>

    <div th:if="${products.isEmpty()}" class="empty-state">
        <div class="empty-state-icon">üì¶</div>
        <h3 class="empty-state-title">–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p class="empty-state-description">–ü—Ä–æ–¥—É–∫—Ç—ã –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É.</p>
        <a th:href="@{/view/products/createForm}" class="btn btn-primary">
            –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç
        </a>
    </div>

    <div class="stats-section">
        <div class="stats-card">
            <h3 class="stats-title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</span>
                    <span class="stat-value" th:text="${#lists.size(products)}">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ</span>
                    <span class="stat-value" id="filteredProductsCount">0</span>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ -->
<div id="editProductModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç</h3>
            <button type="button" class="btn-close" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editProductForm">
                <input type="hidden" id="editProductId" name="id">

                <div class="form-group">
                    <label for="editProductName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                    <input type="text" id="editProductName" name="name" class="form-input" required>
                </div>

                <div class="form-group">
                    <label for="editProductCalories" class="form-label">–ö–∞–ª–æ—Ä–∏–∏ (–Ω–∞ 100–≥)</label>
                    <input type="number" id="editProductCalories" name="caloriesPer100g" class="form-input"
                           step="0.1" min="0" max="1000" required>
                </div>

                <div class="form-group">
                    <label for="editProductProteins" class="form-label">–ë–µ–ª–∫–∏ (–≥ –Ω–∞ 100–≥)</label>
                    <input type="number" id="editProductProteins" name="proteinsPer100g" class="form-input"
                           step="0.1" min="0" max="100" required>
                </div>

                <div class="form-group">
                    <label for="editProductFats" class="form-label">–ñ–∏—Ä—ã (–≥ –Ω–∞ 100–≥)</label>
                    <input type="number" id="editProductFats" name="fatsPer100g" class="form-input"
                           step="0.1" min="0" max="100" required>
                </div>

                <div class="form-group">
                    <label for="editProductCarbs" class="form-label">–£–≥–ª–µ–≤–æ–¥—ã (–≥ –Ω–∞ 100–≥)</label>
                    <input type="number" id="editProductCarbs" name="carbsPer100g" class="form-input"
                           step="0.1" min="0" max="100" required>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary" id="editSubmitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script th:src="@{/js/products.js}"></script>
</body>
</html>