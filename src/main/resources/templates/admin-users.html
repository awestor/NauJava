<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/admin-users.css}">
    <meta name="_csrf" th:content="${_csrf.token}"/>
</head>
<body>
<div th:replace="~{fragments/adminHeader :: header}"></div>

<main class="main-container">
    <div class="page-header">
        <h1 class="page-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
        <span class="admin-badge">ADMIN</span>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-section">
        <div class="stats-card">
            <h3 class="stats-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                    <span class="stat-value" id="totalUsersCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</span>
                    <span class="stat-value" id="activeTodayCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">–°—Ä–µ–¥–Ω–∏–π currentStreak</span>
                    <span class="stat-value" id="avgStreakCount">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
    <div class="controls-section">
        <div class="page-size-selector">
            <label for="pageSizeSelect">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ:</label>
            <select id="pageSizeSelect" class="page-size-select">
                <option value="8">8</option>
                <option value="16" selected>16</option>
                <option value="32">32</option>
                <option value="48">48</option>
            </select>
        </div>

        <div class="last-update">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdateTime">--:--:--</span>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="table-container">
        <table class="users-table">
            <thead>
            <tr>
                <th data-sort="login" class="sortable sort-desc">
                    <span class="th-content">–õ–æ–≥–∏–Ω</span>
                </th>
                <th data-sort="fio" class="sortable">
                    <span class="th-content">–§–ò–û</span>
                </th>
                <th data-sort="lastActivity" class="sortable">
                    <span class="th-content">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                </th>
                <th data-sort="streak" class="sortable">
                    <span class="th-content">–°–µ—Ä–∏—è (–¥–Ω–µ–π)</span>
                </th>
            </tr>
            </thead>
            <tbody id="usersTableBody">
            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            <tr class="loading-row">
                <td colspan="4">
                    <div class="loading-spinner"></div>
                    <div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div class="pagination-container" id="paginationContainer" style="display: none;">
        <div class="pagination">
            <button class="pagination-btn" id="prevPage" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>

            <div class="pagination-pages" id="paginationPages">
                <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <button class="pagination-btn" id="nextPage">
                <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>

        <div class="pagination-info">
            –ü–æ–∫–∞–∑–∞–Ω–æ <span id="shownCount">0</span> –∏–∑ <span id="totalCount">0</span> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö -->
    <div id="noDataMessage" class="empty-state" style="display: none;">
        <div class="empty-state-icon">üë•</div>
        <h3 class="empty-state-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p class="empty-state-description">–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
    </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
<div id="userDetailsModal" class="modal-overlay">
    <div class="modal-content modal-wide">
        <div class="modal-header">
            <h3 class="modal-title">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
            <button type="button" class="btn-close" onclick="closeUserDetailsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="loading-overlay" id="userDetailsLoading">
                <div class="loading-spinner large"></div>
                <div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</div>
            </div>

            <div id="userDetailsContent" style="display: none;">
                <div class="user-details-grid">
                    <div class="detail-section">
                        <h4 class="detail-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                        <div class="detail-item">
                            <span class="detail-label">–õ–æ–≥–∏–Ω:</span>
                            <span class="detail-value" id="detailLogin"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Email:</span>
                            <span class="detail-value" id="detailEmail"></span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4 class="detail-title">–§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
                        <div class="detail-item">
                            <span class="detail-label">–§–∞–º–∏–ª–∏—è:</span>
                            <span class="detail-value" id="detailSurname"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ò–º—è:</span>
                            <span class="detail-value" id="detailName"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–û—Ç—á–µ—Å—Ç–≤–æ:</span>
                            <span class="detail-value" id="detailPatronymic"></span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4 class="detail-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h4>
                        <div class="detail-item highlight">
                            <span class="detail-label">–°–µ—Ä–∏—è (currentStreak):</span>
                            <span class="detail-value" id="detailStreak"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</span>
                            <span class="detail-value" id="detailLastActivity"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                            <span class="detail-value" id="detailCreatedAt"></span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4 class="detail-title">–¶–µ–ª–∏ –ø–∏—Ç–∞–Ω–∏—è</h4>
                        <div class="detail-item">
                            <span class="detail-label">–¶–µ–ª—å –ø–æ –∫–∞–ª–æ—Ä–∏—è–º:</span>
                            <span class="detail-value" id="detailCalorieGoal"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</span>
                            <span class="detail-value" id="detailActivityLevel"></span>
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeUserDetailsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/admin-users.js}"></script>
</body>
</html>