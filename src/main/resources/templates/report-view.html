<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Report View - Calorie Tracker</title>
  <link th:href="@{/css/reports.css}" rel="stylesheet">
  <style>
    .report-content {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        white-space: pre-wrap;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
    }

    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e1e4e8;
    }

    .back-link {
        color: #2ea043;
        text-decoration: none;
        font-weight: 500;
    }

    .back-link:hover {
        text-decoration: underline;
    }

    .admin-badge {
        background: #ffd700;
        color: #000;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 8px;
    }
  </style>
</head>
<body>
<div class="header">
  <div class="nav-container">
    <div class="logo">
      <a href="/view/products/" style="color: white; text-decoration: none;">
        <span class="logo-text">Calorie<span class="logo-accent">Tracker</span></span>
      </a>
    </div>

    <div class="user-info">
      Welcome, <span sec:authentication="name"></span>
      <span class="admin-badge" sec:authorize="hasRole('ADMIN')">ADMIN</span>
      <form th:action="@{/logout}" method="post" class="logout-form">
        <button type="submit" class="btn btn-logout">
          Logout
        </button>
      </form>
    </div>
  </div>
</div>

<div class="container">
  <div class="report-header">
    <h1>Report #<span th:text="${reportId}"></span></h1>
    <a th:href="@{/reports}" class="back-link">← Back to Reports</a>
  </div>

  <div th:if="${status.name() == 'COMPLETED'}">
    <div class="report-content" th:text="${content}">
      Report content will be displayed here...
    </div>
  </div>

  <div th:if="${status.name() == 'CREATED'}" class="report-area">
    <h3>Report is being generated...</h3>
    <div class="loading-spinner"></div>
    <p>Please wait while we finish generating your report.</p>
    <p>This page will automatically refresh when the report is ready.</p>
    <script>
      // Автоматически обновляем страницу каждые 3 секунды
      setTimeout(() => {
          window.location.reload();
      }, 3000);
    </script>
  </div>

  <div th:if="${status.name() == 'ERROR'}" class="report-area" style="border-left-color: #cf222e;">
    <h3>Report Generation Failed</h3>
    <div class="report-content" th:text="${content}">
      Error details will be displayed here...
    </div>
    <a th:href="@{/reports}" class="btn btn-primary">Back to Reports</a>
  </div>
</div>
</body>
</html>